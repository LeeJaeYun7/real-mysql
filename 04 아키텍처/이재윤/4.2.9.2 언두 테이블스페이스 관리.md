

```

Summary

1) 언두 로그가 저장되는 공간을 언두 테이블스페이스(Undo Tablespace)라고 한다.
-> 언두 테이블스페이스는 MySQL 서버의 버전별로 많은 변화가 있었다.
-> MySQL 5.6 이전 버전에서는 언두 로그가 모두 시스템 테이블스페이스(ibdata.ibd)에 저장됐다.
-> 하지만 시스템 테이블스페이스의 언두 로그는 MySQL 서버가 초기화될 때 생성되기 때문에 확장의 한계가 있었다.
-> 그래서 MySQL 5.6버전에선느 innodb_undo_tablespaces 시스템 변수가 도입됐고,
   innodb_undo_tablespaces 시스템 변수를 2보다 큰 값을 설정하면 InnoDB 스토리지 엔진은 더 이상 언두 로그를
   시스템 테이블스페이스에 저장하지 않고 별도의 언두 로그 파일을 사용한다.

2) 하지만 MySQL 5.6 이후 버전에서도 innodb_undo_tablespaces를 0으로 설정하면 여전히 MySQL 5.6 이전의 버전과 동일하게
   언두 로그가 시스템 테이블스페이스에 저장됐다.
-> MySQL 8.0으로 업그레이드되면서 innodb_undo_tablespaces 시스템 변수는 효력이 없어졌으며,
   언두 로그는 항상 시스템 테이블스페이스 외부의 별도 로그 파일에 기록되도록 개선됐다.


3) 그림 4.17은 언두 테이블스페이스가 어떤 형태로 구성되는지를 보여준다.
-> 하나의 언두 테이블스페이스는 1개 이상 128개 이하의 롤백 세그먼트를 가지며,
   롤백 세그먼트는 1개 이상의 언두 슬롯(Undo slot)을 가진다.
-> 하나의 롤백 세그먼트는 InnoDB의 페이지 크기를 16바이트로 나눈 값의 개수만큼의 언두 슬롯을 가진다.
-> 예를 들어, InnoDB의 페이지 크기가 16KB라면 하나의 롤백 세그먼트는 1024개의 언두 슬롯을 갖게 된다.
-> 하나의 트랜잭션이 필요로 하는 언두 슬롯의 개수는 트랜잭션이 실행하는 INSERT, UPDATE, DELETE 문장의 특성에 따라
   최대 4개까지 언두 슬롯을 사용하게 된다.
-> 일반적으로는 트랜잭션이 임시 테이블을 사용하지 않으므로 하나의 트랜잭션은 대략 2개 정도의 언두 슬롯을 필요로 한다고 가정하면 된다.
-> 그래서 최대 동시 처리 가능한 트랜잭션의 개수는 다음 수식으로 예측해볼 수 있다.

4) 가장 일반적인 설정인 16KB InnoDB에서 기본 설정을 사용한다고 가정하면 대략 2097152개 정도의 트랜잭션이 동시에 처리 가능해진다.
-> 물론 일반적인 서비스에서 이 정도까지 동시 트랜잭션이 필요하진 않겠지만, 기본값으로 해서 크게 문제될 건 없으므로 가능하면 기본값을 유지하자.
-> 언두 로그 공간이 남는 것은 크게 문제되지 않지만, 언두 로그 슬롯이 부족한 경우에는 트랜잭션을 시작할 수 없는 심각한 문제가 발생한다.
-> 언두 로그 관련 시스템 변수를 변경해야 한다면 적절히 필요한 동시 트랜잭션 개수에 맞게 언두 테이블스페이스와 롤백 세그먼트의 개수를 설정해야 한다.

5) MySQL 8.0 이전까지는 한 번 생성된 언두 로그는 변경이 허용되지 않고 정적으로 사용됐지만,
   MySQL 8.0 버전부터는 CREATE UNDO TABLESPACE나 DROP TABLESPACE 같은 명령으로 새로운 언두 테이블 스페이스를 동적으로 추가하고 삭제할 수 있게 개선됐다.

```


