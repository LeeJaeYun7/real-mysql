

```

Summary

1) InnoDB 스토리지 엔진은 내부적으로 잠금이 교착 상태에 빠지지 않았는지,
   체크하기 위해 잠금 대기 목록을 그래프(Wait-for-list) 형태로 관리한다.
-> InnoDB 스토리지 엔진은 데드락 감지 스레드를 가지고 있어서, 데드락 감지 스레드가 주기적으로 잠금 대기 그래프를 검사해
   교착 상태에 빠진 트랜잭션들을 찾아서 그 중 하나를 강제 종료한다.
-> 이 때, 어느 트랜잭션을 먼저 강제 종료할 것인지를 판단하는 기준은 트랜잭션의 언두 로그 양이며,
   언두 로그 레코드를 더 적게 가진 트랜잭션이 일반적으로 롤백의 대상이 된다.
-> 트랜잭션이 언두 레코드를 적게 가졌다는 이야기는 롤백을 해도 언두 처리를 해야 할 내용이 적다는 것이며,
   트랜잭션 강제 롤백으로 인한 MySQL 서버의 부하도 덜 유발하기 때문이다.


2) 참고로 InnoDB 스토리지 엔진은 상위 레이어인 MySQL 엔진에서 관리되는 테이블 잠금(LOCK TABLES 명령으로 잠긴 테이블)
   은 볼 수가 없어서 데드락 감지가 불확실할 수도 있는데, innodb_table_locks 시스템 변수를 활성화하면
   InnoDB 스토리지 엔진 내부의 레코드 잠금뿐만 아니라 테이블 레벨의 잠금까지 감지할 수 있게 된다.
-> 특별한 이유가 없다면 innodb_table_locks 시스템 변수를 활성화하자.


3) 일반적인 서비스에서는 데드락 감지 스레드가 트랜잭션의 잠금 목록을 검사해서 데드락을 찾아내는 작업은 크게 부담되지 않는다.
-> 하지만 동시 처리 스레드가 매우 많아지거나 각 트랜잭션이 가진 잠금의 개수가 많아지면 데드락 감지 스레드가 느려진다.
-> 데드락 감지 스레드는 잠금 목록을 검사해야 하기 때문에 잠금 상태가 변경되지 않도록
   잠금 목록이 저장된 리스트(짬금 테이블)에 새로운 잠금을 걸고 데드락 스레드를 찾게 된다.
-> 데드락 감지 스레드가 느려지면 서비스 쿼리를 처리 중인 스레드는 더는 작업을 진행하지 못하고 대기하면서
   서비스에 악영향을 미치게 된다.
-> 이렇게 동시 처리 스레드가 매우 많은 경우 데드락 감지 스레드는 더 많은 CPU 자원을 소모할 수도 있다.


Insight
- 자동 데드락 감지와, 트랜잭션 강제 종료의 기준
-> 데드락이 시스템에 어떤 영향을 미칠 수 있는지에 대한 이해 

Application
- MySQL 백그라운드 스레드들의 역할 이해하고 파악하기 


```
