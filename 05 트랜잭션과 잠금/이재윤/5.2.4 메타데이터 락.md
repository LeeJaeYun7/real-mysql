


```

Summary

1. 메타데이터 락(Metadata Lock)은 데이터베이스 객체(대표적으로 테이블이나 뷰 등)의 이름이나 구조를 변경하는 경우에 획득하는 잠금이다.
-> 메타데이터 락은 명시적으로 획득하거나 해제할 수 있는 것이 아니고, RENAME TABLE taba TO tab_b 같이 테이블의 이름을 변경하는 경우 자동으로 획득하는 잠금이다.
-> RENAME TABLE 명령의 경우 원본 이름과 변경될 이름 두 개 모두 한꺼번에 잠금을 설정한다.
-> 또한, 실시간으로 테이블을 바꿔야 하는 요건이 배치 프로그램에서 자주 발생하는데, 다음 예제를 잠깐 살펴보자.


2. 위와 같이 하나의 RENAME TABLE 명령문에 두 개의 RENAME 작업을 한꺼번에 실행하면 실제 애플리케이션에서는 "Table not found 'rank'같은 상황을 발생시키지 않고 적용하는 것이 가능하다.
-> 하지만 이 문장을 다음과 같이 2개로 나눠서 실행하면 아주 짧은 시간이지만, rank 테이블이 존재하지 않는 순간이 생기며, 그 순간에 실행되는 쿼리는 'Table not found 'rank'오류를 발생시킨다. 


3. 때로는 메타데이터 잠금과 InnoDB의 트랜잭션을 동시에 사용해야 하는 경우도 있다.
-> 예를 들어, 다음과 같은 구조의 INSERT만 실행되는 로그 테이블을 가정해보자.
-> 이 테이블은 웹 서버의 액세스(접근) 로그를 저장만 하기 때문에 UPDATE, DELETE 가 없다.

4. 그런데 어느 날 이 테이블의 구조를 변경해야 할 요건이 발생했다.
-> 물론 MySQL 서버의 Online DDL을 이용해서 변경할 수도 있지만, 시간이 너무 오래 걸리는 경우라면 언두 로그의 증가와 Online DDL이 실행되는 동안
   누적된 Online DDL 버퍼의 크기 등 고민해야 할 문제가 많다.
-> 더 큰 문제는 MySQL 서버의 DDL은 단일 스레드로 작동하기 때문에 상당히 많은 시간이 소모될 것이라는 점이다.
-> 이때는, 새로운 구조의 테이블을 생성하고 먼저 최근의 데이터까지는 프라이머리 키인 id값을 범위별로 나눠서 여러 개의 스레드로 빠르게 복사한다.




```
