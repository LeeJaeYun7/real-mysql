# 디스크 읽기 방식

## 1 디스크 드라이브의 기계식 방식, 전자식 방식

- 기계식 방식은 플레터(원판)을 돌려서 읽어야 할 데이터가 저장된 위치로 디스크 헤더를 이동시켜 읽고 쓸 위치로 옮겨야 한다.
- 그래서 랜덤I/O는 느리다. → DB성능 튜닝의 핵심은 디스크 I/O를 줄이는
- 전자식 방식의 SSD는 랜덤 I/O가 빠르다. → SSD라 할지라도 순차보다 랜덤I/O가 더 느리다
- 순차 I/O는의 성능은 기계식, 전자식 비슷하다.
- DB작업은 랜덤I/O가 많으므로 SSD가 유리하다.

## 2 랜덤I/O와 순차 I/O

- 둘 다 모두 파일에 쓰기를 실행하려면 동기화(fsync, flush)작업이 필요
    - 동기화 작업이 많아지만 순차i/o도 비효율적으로 처리됨.
- **쿼리 튜닝은 랜덤 i/o를 줄이는 것이 목적** → 꼭 필요한 데이터만 읽음
- DB 작업은 작은 데이터를 빈번히 읽고 쓰기 때문에 MySQL 서버에는 `그룹커밋`, `바이너리 로그 버퍼`, `InnoDB 로그 버퍼`의 기능이 내장되어 있다.
    - [ ]  한꺼번에 한다고 랜덤I/O가 줄어드나? 
    커밋,로그버퍼는 데이터 쓰기/업데이트/삭제 와 관련있는데, 
    새로 쓰는 것은 원판 헤더를 돌리지 않고 연속적으로 쓸 수 있으나, 
    업데이트와 삭제는 기존 데이터로 원판을 이동해야 하므로 랜덤 I/O가 발생하는 것은 마찬가지 아닌가 생각든다.

# 인덱스란

- 책의 찾아보기를 생각해본다.
- key : value = 칼럼(칼럼들)의 값 : 레코드 저장된 주소
- 찾아보기와 인덱스의 공통점 : **정렬**
    - 인덱스 : sortedList(정렬)
    - 데이터 파일 : arrayList (저장순서 유지)

## 1 인덱스의 분류

### 1-1 역할별  구분

1. Primary key : 레코드 대표 칼럼의 값
2. Secondary key(index) : 유니크 인덱스(대체키) , PK를 제외한 나머지 인덱스 

### 1-2 저장방식(알고리즘)별 구분

1. B-TREE Index : 칼럼값 변형하지 않고 원래 값 이용해 인덱싱하는 알고리즘 
2. Hash Index : 칼럼의 값으로 해시값 계산해 인덱싱하는 알고리즘 
    - 값이 변경되기 때문에 prefix 일치, 범위 검색에는 사용 불가
    - 메모리 기반 DB에서 많이 사용

### 1-3 데이터 중복 여부  구분

- 옵티마이저에게는 상당히 중요한 문제
1. Unique Index  : 1건의 레코드 찾으면 더 찾지 않ㄴ아도 됨 
2. Non-Unique Index

# B-TREE 인덱스 (Balanced Index)

- 칼럼의 원래 값 변형시키지 않고 인덱스 구조체에서 정렬된 상태로 유지
    - 칼럼의 원래 값 변형시키지 않고 : **실제는 값의 앞부분만 잘라서 관리**한다.
- **인덱스의 리프노드**는 항상 실제 데이터 **레코드를 찾아가기 위한 주소값**을 가지고 있다.
    - 루트노드/브랜치노드는 값으로 자식노드의 주소를 갖고 있고
    - 리프노드는 값으로 주소값을 갖고 있다.
        - [ ]  그림에는 PK를 값으로 갖고 있는데 그게 주소값과 매칭되나?

![image](https://github.com/LeeJaeYun7/real-mysql/assets/99928102/ed60a574-52a3-428a-a09f-8bef4330753d)
## 1 구조와 특성

### 1-1 클러스터링

- 비슷한 값을 최대한 모아서 저장하는 방식
- InnoDB 테이블에서 레코드는 클러스터되어 디스크에 저장
    - 즉,  **PK순서로 정렬**되어 저장

### 1-2

- **인덱스는 테이블의 키 칼럼만 갖고 있다. 그러므로 나머지 칼럼을 읽으려면 데이터 파일에서 해당 레코드를 찾아야 한다.**
- 인덱스의 리프 노드는 데이터 파일에 저장된 레코드의 주소를 가진다.
- InnoDB

![image](https://github.com/LeeJaeYun7/real-mysql/assets/99928102/597fb038-017f-482b-b16a-a627a76acbcd)
- MyISAM
![image](https://github.com/LeeJaeYun7/real-mysql/assets/99928102/5fb94e86-a886-4b96-8e3d-a218a5b17cc5)

